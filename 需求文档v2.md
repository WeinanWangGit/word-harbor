# Word Harbor 需求文档 v2

> 本次迭代核心目标：**优化视觉动画体验 + 修复核心机制漏洞**

---

## 一、项目定位（不变）

以抽卡 + 收藏 + 互动为核心的英语单词学习 Web App。

**核心原则**：
- 抽卡 ≠ 学习 → 互动才算学习
- 体验驱动，视觉优先
- 保持轻量，克制复杂度

---

## 二、本次迭代范围

### 2.1 必做（P0）

| 功能 | 说明 |
|------|------|
| 抽卡动画升级 | 稀有度差异化动画，4星有专属特效 |
| 重复卡牌机制 | 重复抽到 → 掌握度+1，有明确反馈 |
| 卡牌入场动画 | 结果弹层的卡牌翻转/光效 |

### 2.2 应做（P1）

| 功能 | 说明 |
|------|------|
| 10连保底 | 累计10次必出3星及以上 |
| 首页秘书舰 | 可设置一张卡为主展示，有互动 |
| 每日复习 | 随机3题快速复习，答对有奖励 |

### 2.3 可选（P2）

| 功能 | 说明 |
|------|------|
| 连续登录 | 7天累计奖励一次保底抽 |
| 图鉴动效 | 新卡解锁时的点亮动画 |

---

## 三、视觉动画详细设计（重点）

### 3.1 抽卡按钮

**静态**：
- 圆形按钮，中心有柔和的呼吸光晕
- 边缘有缓慢旋转的光圈粒子

**点击时**：
- 按钮收缩 → 弹出
- 光圈加速旋转并向外扩散

**无次数时**：
- 灰度显示，光效消失
- 轻微摇晃提示"明天再来"

---

### 3.2 抽卡过程动画（核心体验）

**阶段1 - 蓄力（0.5s）**
- 屏幕中心出现光点
- 背景逐渐变暗

**阶段2 - 建造（1-2s）**
- 根据稀有度决定时长：
  - 1-2星：1s
  - 3星：1.5s
  - 4星：2s（制造期待感）
- 光点扩散成光环，不断收缩扩张
- 3星以上：光环变色（蓝/紫）

**阶段3 - 揭示（0.5s）**
- 光环爆开
- 稀有度特效：
  - 1星：普通散开
  - 2星：绿色光芒
  - 3星：蓝色光柱 + 粒子
  - 4星：紫色全屏闪光 + 彩虹粒子雨

---

### 3.3 结果弹层

**卡牌入场**：
- 卡牌从上方落下，轻微弹跳
- 或：卡牌背面翻转到正面

**稀有度边框**：
- 1星：灰色静态边框
- 2星：绿色微光边框
- 3星：蓝色流动光边
- 4星：紫金渐变 + 粒子环绕

**NEW 标识**：
- 首次获得：右上角显示「NEW」标签，有闪烁效果

**重复获得**：
- 显示「掌握度 +1」，有经验条上涨动画
- 如果已满级：显示「已精通」金色标识

---

### 3.4 首页秘书舰

**展示**：
- 卡牌居中大图展示
- 背景有该卡牌稀有度对应的氛围光
- 卡牌有轻微的上下浮动（呼吸感）

**交互**：
- 点击卡牌：显示随机一条例句
- 长按：进入详情页

**切换**：
- 左右滑动切换已有卡牌
- 或点击小按钮打开选择列表

---

### 3.5 图鉴页动效

**未解锁卡牌**：
- 剪影显示，轻微晃动的问号

**新解锁卡牌**：
- 首次进入图鉴时，新卡有「点亮」动画
- 从剪影渐变到彩色，伴随光效扩散

**掌握度指示**：
- 三个圆点，点亮时有填充动画
- 满级时变成金色，有微光

---

### 3.6 互动答题

**选项点击**：
- 按钮按下有缩放反馈

**正确**：
- 选项变绿，有「✓」图标弹出
- 撒花/星星粒子效果
- 掌握度条上涨动画

**错误**：
- 选项变红，轻微抖动
- 正确答案高亮提示

---

## 四、机制调整

### 4.1 重复卡牌机制

```
抽到已拥有卡牌时：
  if 掌握度 < 3:
    掌握度 += 1
    显示「掌握度 +1」动画
  else:
    显示「已精通」
    （后续可考虑转化为其他奖励）
```

### 4.2 保底机制

```
记录连续未出3星以上的次数（pityCount）
每次抽卡：
  if pityCount >= 9:
    强制从3星及以上卡池抽取
    pityCount = 0
  else:
    正常抽取
    if 抽到3星以上:
      pityCount = 0
    else:
      pityCount += 1
```

### 4.3 每日复习（轻量版）

- 入口：首页显示「今日复习」按钮（如果有已拥有卡牌）
- 流程：
  1. 随机抽取3张已拥有卡牌
  2. 依次展示互动题
  3. 全部答对：奖励额外1次抽卡机会（当日有效）
- 每日限1次

---

## 五、数据结构调整

### UserState 新增字段

```ts
interface UserState {
  // 原有
  ownedCardIds: string[]
  masteryMap: Record<string, number>
  dailyGachaRemaining: number
  lastLoginDate: string

  // 新增
  pityCount: number              // 保底计数
  secretaryCardId: string | null // 秘书舰卡牌ID
  dailyReviewDone: boolean       // 今日复习是否完成
  bonusGacha: number             // 奖励抽卡次数
}
```

---

## 六、技术实现建议

### 动画技术选型

| 动画类型 | 推荐方案 |
|----------|----------|
| 简单过渡 | CSS Transition / Tailwind |
| 复杂序列动画 | Framer Motion |
| 粒子效果 | CSS + JS 或 tsparticles（轻量） |
| 光效/模糊 | CSS filter + gradient |

### 不建议使用
- Lottie（文件体积大，设计成本高）
- Canvas 重绘（性能考虑）
- 任何需要额外设计资源的方案

---

## 七、明确不做

- ❌ 货币/积分系统（复杂度过高）
- ❌ 好感度/羁绊系统（后续版本）
- ❌ 限时活动/多卡池（内容量不足）
- ❌ 音效系统（本次不涉及）
- ❌ 后端/账号系统

---

## 八、迭代顺序建议

1. **第一步**：升级抽卡动画 + 结果弹层动效
2. **第二步**：实现重复卡牌机制
3. **第三步**：添加保底系统
4. **第四步**：首页秘书舰
5. **第五步**：每日复习
6. **第六步**：图鉴动效打磨

---

## 九、验收标准

- [ ] 4星抽卡有明显的「出货感」
- [ ] 重复卡牌有正向反馈，不觉得白抽
- [ ] 首页有情感连接（秘书舰）
- [ ] 整体动画流畅，无卡顿
- [ ] 刷新页面数据不丢失（含新字段）
